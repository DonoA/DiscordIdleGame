# Design Doc 05: Add Bits Metric

## 1. Overview

This document describes the plan to introduce a new global metric called "bits" into the application. Bits will serve as a persistent, application-wide score that increases based on user activity, specifically message sending and time spent in voice channels.

## 2. Key Features

*   **Global Bit Counter:** A single, global counter that tracks the total number of bits earned.
*   **Bits per Message:** The bit counter will increment every time a new message is generated by the simulation.
*   **Bits per Second in Voice:** The bit counter will increment for every second that any user spends in a voice channel.

## 3. UI Modifications

*   A new UI component will be created to display the current bit count. This component will be placed in the top-left corner of the `ChannelList` panel, above the server name, to ensure it is always visible.

## 4. Redux State and Reducer Modifications

*   **New `bitsReducer.js`:**
    *   A new reducer will be created to manage the `bits` slice of the state.
    *   The state will be a simple number, representing the total bit count.
    *   It will handle actions that increment the bit count.
    *   Initial state: `0`.
*   **Root Reducer (`reducers/index.js`):**
    *   The new `bitsReducer` will be added to the `combineReducers` call.

## 5. New Actions

*   **`INCREMENT_BITS`:** A new action type and action creator will be defined to handle incrementing the bit count. The payload will specify the amount to increment by.

## 6. Simulation Logic Modifications (`simulation.js`)

The core simulation logic will be updated to dispatch the `INCREMENT_BITS` action based on user activity.

*   **Message Generation:**
    *   When the simulation generates a new message and dispatches `ADD_RANDOM_MESSAGE`, it will also dispatch an `INCREMENT_BITS` action (e.g., by 1 bit).
*   **Voice Channel Activity:**
    *   A new mechanism will be added to the simulation's main `setInterval` loop.
    *   On each tick (e.g., every 2 seconds), the simulation will check how many users are currently in any voice channel.
    *   It will then dispatch an `INCREMENT_BITS` action, with the increment amount being the number of users in voice channels multiplied by the interval duration in seconds (e.g., `numUsersInVoice * 2`).

## 7. Component Modifications

*   **`ChannelList.js`:**
    *   This component will be modified to include a new `BitCounter` display element at the top.
    *   It will use `useSelector` to get the current `bits` value from the Redux state and render it.

## 8. Implementation Plan

1.  Create the new `bitsReducer.js` file and add it to the root reducer.
2.  Define the `INCREMENT_BITS` action type and create its corresponding action creator in `actions/`.
3.  Update the `simulation.js` file to dispatch the `INCREMENT_BITS` action when messages are sent and based on the number of users in voice channels.
4.  Modify the `ChannelList.js` component to display the global bit count.
5.  Add any necessary styling for the new bit counter display.
6.  Verify all changes with `npm run build`.